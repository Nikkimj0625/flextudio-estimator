<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>í”Œë ‰ìŠ¤íŠœë””ì˜¤ ê°€ê²¬ì  ê³„ì‚°ê¸°</title>
  <script src="https://unpkg.com/xlsx@0.19.3/dist/xlsx.full.min.js"></script>
  <style>
    body {font-family: Pretendard, sans-serif; max-width: 820px; margin: 20px auto; padding: 20px; line-height: 1.6; color: #333;}
    h2 {border-bottom: 2px solid #ccc; padding-bottom: 5px;}
    label {display: block; margin: 8px 0 4px;}
    select, input[type=number] {width: 100%; padding: 6px; margin-bottom: 10px; box-sizing: border-box;}
    .row {display: flex; gap: 10px; align-items: center; flex-wrap: wrap;}
    .row > div {flex: 1; min-width: 46%;}
    button {background: #222; color: #fff; border: none; padding: 8px 14px; cursor: pointer; margin-top: 6px;}
    .result {white-space: pre-line; margin-top: 20px; font-size: 1.1em; font-weight: 600;}
    .group-box {margin-bottom: 28px; padding: 14px; border: 2px solid #aaa; border-radius: 8px; background: #f0f4f8;}
    .license-group {background: #f9f9f9; border: 1px solid #ddd; padding: 12px; border-radius: 6px; margin-bottom: 18px;}
    .license-group .row div {min-width: 45%;}
    .task-remove {float: right; background: #f55; border-radius: 4px; padding: 2px 6px; font-size: .85em; margin-top: -8px; color: #fff;}
  </style>
</head>
<body>
<h2>í”Œë ‰ìŠ¤íŠœë””ì˜¤ ê°€ê²¬ì  ê³„ì‚°ê¸°</h2>
<div class="group-box">
  <h3>1ï¸âƒ£ êµ¬ì¶• ê²¬ì  ê³„ì‚°</h3>
  <div id="taskContainer"></div>
  <button onclick="addTaskBlock()">ì—…ë¬´ í•­ëª© ì¶”ê°€í•˜ê¸°</button>
</div>
<div class="group-box">
  <h3>2ï¸âƒ£ ë¼ì´ì„ ìŠ¤ ìœ í˜• ì„ íƒ</h3>
  <div class="license-group">
    <label><input type="radio" name="licenseType" value="subscription" checked onclick="toggleLicense('subscription')"> êµ¬ë…í˜•</label>
    <label><input type="radio" name="licenseType" value="fixed" onclick="toggleLicense('fixed')"> êµ¬ì¶•í˜•</label>
  </div>
  <div id="subscriptionLicense" class="license-group">
    <h4>ğŸ“„ êµ¬ë…í˜• ë¼ì´ì„ ìŠ¤ ì…ë ¥</h4>
    <div class="row">
      <div><label>ê°œë°œì ìˆ˜:</label><input type="number" id="developerCount" value="1" min="1"></div>
      <div><label>ë‚´ë¶€ ì‚¬ìš©ì ìˆ˜:</label><input type="number" id="internalUsers" value="50" min="50"></div>
    </div>
    <div class="row">
      <div><label>ì‹œìŠ¤í…œ ì—°ë™ ìˆ˜ (ERP, DB ë“±):</label><input type="number" id="integrationCount" value="1" min="1"></div>
      <div><label>ì—° ë‹¨ìœ„ í• ì¸ìœ¨(%):</label><input type="number" id="discountRate" value="10"></div>
    </div>
    <div class="row">
      <div>
        <label>ë¼ì´ì„ ìŠ¤ ê²°ì œ ì£¼ê¸°:</label>
        <select id="billingCycle"><option value="1">ì›”</option><option value="12">ì—°(12ê°œì›”)</option></select>
      </div>
      <div>
        <label>ë³´ì•ˆì‚¬í•­ (ì›” 450,000)</label>
        <label><input type="checkbox" class="licenseOption" value="450000"> Azure AD SSO</label>
        <label><input type="checkbox" class="licenseOption" value="450000"> AWS VPN</label>
      </div>
    </div>
  </div>
  <div id="fixedLicense" class="license-group" style="display:none">
    <h4>ğŸ—ï¸ êµ¬ì¶•í˜• ë¼ì´ì„ ìŠ¤ ì…ë ¥</h4>
    <p><strong>ê¸°ë³¸ í¬í•¨:</strong> ì›Œí¬ìŠ¤í˜ì´ìŠ¤, ê°œë°œì 3ëª…, FSK, ë‚´ë¶€ ì‚¬ìš©ì 500ëª…</p>
    <div class="row">
      <div><label>ì¶”ê°€ ê°œë°œì ìˆ˜:</label><input type="number" id="fixedDevCount" value="0"></div>
      <div><label>ì¶”ê°€ ë‚´ë¶€ ì‚¬ìš©ì ìˆ˜:</label><input type="number" id="fixedUserCount" value="0"></div>
      <div><label>ëŒ€ìš©ëŸ‰ ì¶”ê°€ ì‚¬ìš©ì ìˆ˜:</label><input type="number" id="bulkUserCount" value="0"></div>
    </div>
  </div>
</div>
<button onclick="calculateEstimate()">ğŸ’° ê°€ê²¬ì  ê³„ì‚°í•˜ê¸°</button>
<button id="downloadBtn" onclick="exportExcel()" disabled>ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
<div class="result" id="result"></div>
<script>
function toggleLicense(t){
  subscriptionLicense.style.display = t==='subscription' ? 'block' : 'none';
  fixedLicense.style.display = t==='fixed' ? 'block' : 'none';
}
function addTaskBlock(){
  const c=document.getElementById('taskContainer');
  const b=document.createElement('div');
  b.className='group-box';
  b.innerHTML=`<button class="task-remove" onclick="this.parentNode.remove()">ì‚­ì œ</button>
  <label>ì—…ë¬´ ìœ í˜•:</label><select class="taskType">
    <option>ê±°ë˜ í”„ë¡œì„¸ìŠ¤í˜•</option><option>ë¬¸ì„œ ì²˜ë¦¬í˜•</option><option>ìì‚°/ì„¤ë¹„ ê´€ë¦¬í˜•</option>
    <option>ì‚¬ìš©ì ìš”ì²­í˜•</option><option>ë¶„ì„/ë¦¬í¬íŠ¸í˜•</option></select>
  <label>ì£¼ìš” í™”ë©´ ë³µì¡ë„:</label><select class="screenGrade">
    <option value="1.0">S-ë‹¨ìˆœ ì¡°íšŒí˜•</option>
    <option value="1.5">A-ì…ë ¥/ìŠ¹ì¸í˜•</option>
    <option value="2.0">B-ë³µí•© ì¡°ê±´í˜•</option></select>
  <label>ê¸°ëŠ¥ ì˜µì…˜:</label>
    <label><input type="checkbox" value="0.5"> ì‹œìŠ¤í…œ ì—°ë™</label>
    <label><input type="checkbox" value="0.3"> ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤</label>
    <label><input type="checkbox" value="0.5"> ëª¨ë°”ì¼ ëŒ€ì‘</label>
    <label><input type="checkbox" value="0.3"> Excel ì—…/ë‹¤ìš´</label>`;
  c.appendChild(b);
}
let lastSheets=null;
function calculateEstimate(){
  let tasks=[]; let totalMM=0;
  document.querySelectorAll('#taskContainer .group-box').forEach((b,i)=>{
    const type=b.querySelector('.taskType').value;
    const screen=parseFloat(b.querySelector('.screenGrade').value);
    let opt=0;
    b.querySelectorAll('input[type=checkbox]:checked').forEach(o=>opt+=parseFloat(o.value));
    const mm=screen+opt;
    totalMM+=mm;
    tasks.push({No:i+1,ì—…ë¬´ìœ í˜•:type,í™”ë©´ë“±ê¸‰:(screen).toFixed(1),ì˜µì…˜MM:opt.toFixed(1),ì´MM:mm.toFixed(1)});
  });
  const licenseType=document.querySelector('input[name=licenseType]:checked').value;
  let licenseInfo={ìœ í˜•:licenseType};
  if(licenseType==='subscription'){
    let dev=Math.max(1,+developerCount.value);
    let intg=Math.max(1,+integrationCount.value);
    let usr=Math.max(50,+internalUsers.value);
    developerCount.value=dev;
    integrationCount.value=intg;
    internalUsers.value=usr;
    const sec=[...document.querySelectorAll('.licenseOption:checked')].length*450000;
    const bill=+billingCycle.value;
    const disc=+discountRate.value;
    base=(dev*150000+intg*100000+usr*10000+sec);
    let lic=base*bill;
    if(bill===12)lic*=1-disc/100;
    licenseInfo={ìœ í˜•:'êµ¬ë…í˜•',ê°œë°œììˆ˜:dev,ì‹œìŠ¤í…œì—°ë™:intg,ì‚¬ìš©ì:usr,ë³´ì•ˆë¹„ìš©:sec,ê²°ì œì£¼ê¸°:bill===1?'ì›”':'ì—°',í• ì¸ìœ¨:`${disc}%`,ë¼ì´ì„ ìŠ¤ë¹„ìš©:lic};
  } else {
    const addDev=+fixedDevCount.value,addUsr=+fixedUserCount.value,bulk=+bulkUserCount.value,fixed=30000000+addDev*1500000+addUsr*100000+bulk*50000;
    const m=fixed*0.15;
    licenseInfo={ìœ í˜•:'êµ¬ì¶•í˜•',ì¶”ê°€Dev:addDev,ì¶”ê°€User:addUsr,bulkUser:bulk,ê¸°ë³¸ë¹„ìš©:fixed,ìœ ì§€ë³´ìˆ˜:m};
  }
  lastSheets={tasks,licenseInfo,totalMM};
  document.getElementById('result').innerText=`ì´ ê°œë°œ ê³µìˆ˜: ${totalMM.toFixed(1)} MM\në¼ì´ì„ ìŠ¤ ìœ í˜•: ${licenseInfo.ìœ í˜•}`;
  document.getElementById('downloadBtn').disabled = false;
}
function exportExcel(){
  if(!lastSheets){alert('ë¨¼ì € ê°€ê²¬ì ì„ ê³„ì‚°í•˜ì„¸ìš”');return;}
  if(typeof XLSX==='undefined'){
    alert('XLSX ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. CSVë¡œ ëŒ€ì‹  ì €ì¥í•©ë‹ˆë‹¤.');
    return exportCSV();
  }
  try {
    const wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet(lastSheets.tasks),'ê³µìˆ˜');
    XLSX.utils.book_append_sheet(wb,XLSX.utils.json_to_sheet([lastSheets.licenseInfo]),'ë¼ì´ì„ ìŠ¤');
    XLSX.writeFile(wb,'Flextudio_Estimate.xlsx');
  } catch(e){
    console.error('ì—‘ì…€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', e);
    alert('ì—‘ì…€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†” í™•ì¸ í›„ ê°œë°œìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
  }
}
function exportCSV(){
  const rows=[['ê³µìˆ˜ ì‹œíŠ¸']];
  rows.push(Object.keys(lastSheets.tasks[0]));
  lastSheets.tasks.forEach(r=>rows.push(Object.values(r)));
  rows.push([]);
  rows.push(['ë¼ì´ì„ ìŠ¤ ì‹œíŠ¸']);
  rows.push(Object.keys(lastSheets.licenseInfo));
  rows.push(Object.values(lastSheets.licenseInfo));
  let csv=rows.map(r=>r.map(v=>`"${v}"`).join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='Flextudio_Estimate.csv';
  document.body.appendChild(a);
  a.click();
  a.remove();
}
</script>
</body>
</html>
