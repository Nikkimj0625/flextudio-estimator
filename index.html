<script>
const fmt=n=>n.toLocaleString();

function toggle(){
 const t=document.querySelector('input[name=licType]:checked').value;
 document.getElementById('subBox').style.display= t==='sub'?'block':'none';
 document.getElementById('fixBox').style.display= t==='fix'?'block':'none';
}
function cycleChanged(){
 const cycle = document.getElementById('cycle').value;
 document.getElementById('extraDisc').disabled = (cycle === 'm');
}

function calc() {
  const inputCnt = parseInt(document.getElementById('inputCnt').value) || 0;
  const viewCnt = parseInt(document.getElementById('viewCnt').value) || 0;
  const multi = document.getElementById('multi').checked;
  const intCnt = parseInt(document.getElementById('intCnt').value) || 0;
  const rbac = document.getElementById('rbac').checked;

  let mm = inputCnt * 1.0 + viewCnt * 0.6 + intCnt * 0.5 + (rbac ? 0.3 : 0);
  if (multi) mm *= 1.1;
  mm = Math.round(mm * 100) / 100;

  const devMM = 13000000;
  const devCost = Math.round(mm * devMM);
  const designCost = Math.round(devCost * 0.3);
  const buildCost = devCost + designCost;

  const licType = document.querySelector('input[name=licType]:checked').value;
  let licCost = 0, licDesc = '';

  if (licType === 'sub') {
    const devCnt = parseInt(document.getElementById('devCnt').value) || 1;
    const userCnt = parseInt(document.getElementById('userCnt').value) || 50;
    const dataOpt = document.getElementById('dataOpt').value;
    const sso = document.getElementById('sso').checked;
    const vpn = document.getElementById('vpn').checked;
    const cycle = document.getElementById('cycle').value;
    let extraDisc = parseInt(document.getElementById('extraDisc').value) || 0;

    let cost = 0;
    cost += devCnt * 150000;
    cost += dataOpt === 'flexdb' || dataOpt === 'db' ? 300000 : 0;
    if (sso) cost += 450000;
    if (vpn) cost += 450000;
    cost += 100000 + (userCnt > 50 ? (userCnt - 50) * 2000 : 0);

    if (cycle === 'y') {
      cost = cost * 12 * (1 - (0.10 + extraDisc / 100));
    }

    cost = Math.round(cost);
    document.getElementById('warn').style.display = cost < 550000 && cycle === 'm' ? 'block' : 'none';
    licCost = cost;
    licDesc = `êµ¬ë…í˜• / ${cycle === 'm' ? 'ì›” ì²­êµ¬' : 'ì—° ì²­êµ¬'}`;
  } else {
    const addDev = parseInt(document.getElementById('addDev').value) || 0;
    const addUser10 = parseInt(document.getElementById('addUser10').value) || 0;
    const addUser500 = parseInt(document.getElementById('addUser500').value) || 0;

    licCost = 50000000;
    licCost += addDev * 5000000;
    licCost += Math.floor(addUser10 / 10) * 300000;
    licCost += addUser500 * 10000000;

    licDesc = 'êµ¬ì¶•í˜• / ì¼ì‹œë¶ˆ';
  }

  const total = buildCost + licCost;

  document.getElementById('result').innerHTML = `
    <table>
      <thead><tr><th>êµ¬ë¶„</th><th>ë‚´ìš©</th><th>ê¸ˆì•¡</th></tr></thead>
      <tbody>
        <tr><td colspan="3" class="highlight">ğŸ“¦ êµ¬ì¶• ê¸ˆì•¡</td></tr>
        <tr><td>ì´ ê³µìˆ˜</td><td>${mm.toFixed(2)} MM</td><td>-</td></tr>
        <tr><td>ê°œë°œ ë¹„ìš©</td><td>â‚©13,000,000/MM ì ìš©</td><td>${fmt(devCost)}ì›</td></tr>
        <tr><td>UI/UX ì»¨ì„¤íŒ…</td><td>êµ¬ì¶•ë¹„ì˜ 30%</td><td>${fmt(designCost)}ì›</td></tr>
        <tr><td colspan="3" class="highlight">ğŸ’³ ë¼ì´ì„ ìŠ¤ ê¸ˆì•¡</td></tr>
        <tr><td>ë¼ì´ì„ ìŠ¤</td><td>${licDesc}</td><td>${fmt(licCost)}ì›</td></tr>
        <tr><td colspan="3" class="highlight">ì´ ê²¬ì  ê¸ˆì•¡: ${fmt(total)}ì›</td></tr>
      </tbody>
    </table>`;
}
</script>
